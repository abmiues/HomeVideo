<!DOCTYPE html>
<html lang="ch">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="/js/md5.js"></script>
    <% include head.html %>
    <link rel="stylesheet" href="/css/floatPlane.css"/>
</head>
<body>
<div class="main-content">
    <div class="row">
        <div style="text-align: center">
            <% if(msg){ %>
            <h4><%=msg%></h4>
            <% }%>
        </div>
    </div>
    <div class="row">
        <form action="addbangumi" method="post">
            <div class="form-group">
                <label for="title">标 题</label>
                <input type="text" class="form-control" id="title" name="title" placeholder="标 题">
            </div>
            <div class="form-group">
                <label for="des">简 介</label>
                <input type="text" class="form-control" id="des" name="des" placeholder="简 介">
            </div>
            <div class="form-group">
                <label for="time">开播时间</label>
                <input type="text" class="form-control" id="time" name="time" placeholder="开播时间">
            </div>
            <div class="form-group">
                <label for="cover">封面路径</label>
                <input type="text" class="form-control" id="cover" name="cover" placeholder="封面路径">
            </div>
            <div class="form-group">
                <label for="group">归属系列</label>
                <input type="text" class="form-control" id="group",name="group" placeholder="归属系列">
                <ul class="bangumiGroupList">
                </ul>
            </div>
            <div class="form-group">
                <label for="part">系列第几季</label>
                <input type="number" class="form-control" id="part",name="part" placeholder="系列第几季">
            </div>
            <button type="submit" class="btn btn-default" >确定</button>
        </form>
    </div>

</div>

<div id="bangumiGroup" class="float_planeBg">
    <div class="float_planeShow">
        <div class="form-group">
            <label for="groupTitle">番剧名称</label>
            <input type="text" class="form-control" name="groupTitle" id="groupTitle" placeholder="番剧名称">
        </div>
        <button  class="btn btn-default" onclick=addNewBangumiGroup()>确定</button>
    </div>
</div>

</div>

<script>


    var inputGroup=$('#group')[0];
    var groupListParent=$('.bangumiGroupList')[0];
    var hasFocus=false;
    var lastSelectUI;
    SetList();
    groupListParent.onmouseenter=()=>{
        hasFocus=true;
    }
    groupListParent.onmouseleave=()=>{
        hasFocus=false;
    }

    inputGroup.onfocus=()=>{
        groupListParent.style.display='block';
    };
    inputGroup.onblur=()=>{
        if(hasFocus)
            return;
        groupListParent.style.display='none';
    }
    function SetList() {

        var data=[{name:"未设置" ,index:0},{name:"分组1" ,index:1},{name:"分组1" ,index:4}]
        for(let i=0,count=data.length;i<count;i++)
        {
            let li = document.createElement("li");
            li.innerHTML=data[i].name;
            li.onclick=function (e){OnItemClick(li,data[i].index);}

            groupListParent.append(li);
        }
       /* var li = $("<li>")[0];
        li.innerHTML=data[i].name;
        parent.append(li);*/
    }
    function OnItemClick(ui,index) {
        console.log(index)
        groupListParent.style.display='none';
        if(lastSelectUI)
            lastSelectUI.setAttribute('class','');
        ui.setAttribute('class','on')
        lastSelectUI=ui;
    }

    //$('#group').oninput
    function addNewBangumiGroup() {


        var title=$('#title').val();
        var des=$('#des').val();
        var time=$('#time').val();
        var cover=$('#cover').val();
        var group=$('#group').val();
        var part=$('#part').val();
        var groupTitle=$('#groupTitle').val();
        var data={title:title,des:des,time:time,cover:cover,group:group,part:part,groupTitle:groupTitle};
        var form = $("<form>"); //定义一个form表单  
        form.attr("style", "display:none");
        form.attr("method", "post");
        form.attr("action", "addbangumigroup");
        for(var key in data) {
            var input1 = $("<input>");
            input1.attr("type", "hidden");
            input1.attr("name", key);
            input1.attr("value", data[key]);
            form.append(input1);
        }
        $("body").append(form); //将表单放置在web中  
        form.submit(); //表单提交()

        /* $.post('addbangumigroup',data, function(data){
             console.log(data);
         }, 'json')*/
    }
    function GetBangumiGroup() {
        $.ajax({
            type:"post",//type可以为post也可以为get
            url:"getbangumigroup",
            data:{},//这行不能省略，如果没有数据向后台提交也要写成data:{}的形式
            dataType:"json",//这里要注意如果后台返回的数据不是json格式，那么就会进入到error:function(data){}中
            success:function(data){
                if(data.err) alert(data.err);
                else
                {
                }
            },
            error:function(data){
                alert("获取番剧合集列表错误");
            }
        });
    }
</script>
</body>
</html>
